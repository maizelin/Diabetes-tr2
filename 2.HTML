<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç³–å°¿ç—…ç”¨è—¥æ±ºç­–æ”¯æ´ç³»çµ±</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: #f0f4f8; margin: 0; padding: 20px; }
    .container { max-width: 1100px; margin: auto; }
    h1 { text-align: center; color: #2c3e50; }
    .patient-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 40px; }
    .patient-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; transition: 0.3s; }
    .patient-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
    .patient-card h3 { margin: 0 0 10px 0; color: #3498db; }
    .patient-card p { margin: 5px 0; color: #555; }
    .selected { border: 3px solid #3498db; }
    .content { display: none; background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); position: relative; }
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: 0.3s;
    }
    .back-btn:hover { background: #2980b9; transform: translateY(-2px); }
    canvas { max-height: 350px; }
    .indicators { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; margin: 30px 0; }
    .indicator { text-align: center; }
    .bar { height: 40px; border-radius: 8px; line-height: 40px; color: white; font-weight: bold; font-size: 1.2em; text-shadow: 1px 1px 2px black; }
    .green { background: #27ae60; }
    .yellow { background: #f39c12; }
    .red { background: #e74c3c; }
    .recommendations { margin-top: 30px; }
    .rec-item { background: #f8f9fa; padding: 15px; border-left: 5px solid #3498db; margin: 10px 0; border-radius: 6px; }
    .rec-high { border-left-color: #e74c3c; background: #fdf2f2; }
    footer { text-align: center; margin-top: 50px; color: #95a5a6; font-size: 0.9em; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ç³–å°¿ç—…ç”¨è—¥æ±ºç­–æ”¯æ´ç³»çµ±</h1>
    <p style="text-align:center; color:#7f8c8d;">åŸºæ–¼ ADA 2025 æŒ‡å¼• â€¢ å€‹äººåŒ–ç”¨è—¥å»ºè­°</p>

    <h2 style="color:#2c3e50;">è«‹é¸æ“‡æ¸¬è©¦å€‹æ¡ˆ</h2>
    <div class="patient-selector" id="patientSelector"></div>

    <div class="content" id="patientContent">
      <button class="back-btn" onclick="backToSelector()">â† è¿”å›å€‹æ¡ˆé¸æ“‡</button>

      <h2 id="patientName" style="margin-left:40px;"></h2>
      <p id="patientInfo" style="margin-left:40px;"></p>

      <h3 style="margin-left:40px;">å…©å¹´ HbA1c è¶¨å‹¢</h3>
      <canvas id="hba1cChart"></canvas>

      <h3 style="margin-left:40px;">è‡¨åºŠæŒ‡æ¨™ï¼ˆæœ€æ–°å€¼ï¼‰</h3>
      <div class="indicators" id="indicators"></div>

      <h3 style="margin-left:40px;">ADA 2025 å€‹äººåŒ–ç”¨è—¥å»ºè­°</h3>
      <div class="recommendations" id="recommendations"></div>
    </div>
  </div>

  <footer>æ¸¬è©¦è³‡æ–™ä¾†æºï¼šTHAS FHIR Sandbox â€¢ 2025-12-28 â€¢ åƒ…ä¾›æ•™è‚²èˆ‡å±•ç¤ºç”¨é€”</footer>

  <script>
    // === 5 ä½æ¸¬è©¦ç—…äººå®Œæ•´å…§å»ºè³‡æ–™ ===
    const patients = [
      {
        id: "683785",
        name: "é™³å¿—æ˜",
        gender: "ç”·",
        birthDate: "1980-01-01",
        age: 45,
        scenario: "å¹´è¼•æ–°è¨ºæ–·ï¼Œå¿«é€Ÿæ”¹å–„",
        target: 7.0,
        latestHba1c: 7.1,
        egfr: 90,
        bmi: 27,
        hba1cSeries: [9.5,9.3,9.0,8.8,8.5,8.3,8.1,8.0,7.9,7.8,7.7,7.6,7.5,7.4,7.3,7.3,7.2,7.2,7.1,7.1,7.1,7.1,7.1,7.1,7.1]
      },
      {
        id: "683813",
        name: "ç‹å°æ˜",
        gender: "ç”·",
        birthDate: "1963-01-01",
        age: 62,
        scenario: "ç³–å°¿ç—…åˆä½µä¸­åº¦è…ç—…è®Š",
        target: 7.5,
        latestHba1c: 7.6,
        egfr: 45,
        bmi: 26,
        hba1cSeries: [8.5,8.4,8.3,8.2,8.1,8.0,7.9,7.9,7.8,7.8,7.7,7.7,7.7,7.7,7.6,7.6,7.6,7.6,7.6,7.6,7.6,7.6,7.6,7.6,7.6]
      },
      {
        id: "683847",
        name: "æ—é˜¿èŠ±",
        gender: "å¥³",
        birthDate: "1960-05-15",
        age: 65,
        scenario: "é«˜é½¡å¤šå…±ç—…ï¼Œç›®æ¨™æ”¾å¯¬",
        target: 8.0,
        latestHba1c: 7.5,
        egfr: 55,
        bmi: 22,
        hba1cSeries: [7.8,7.7,7.6,7.7,7.5,7.6,7.8,7.7,7.6,7.5,7.6,7.7,7.5,7.6,7.4,7.5,7.6,7.7,7.6,7.5,7.6,7.7,7.5,7.6,7.5]
      },
      {
        id: "683882",
        name: "å¼µå®¶è±ª",
        gender: "ç”·",
        birthDate: "1985-03-20",
        age: 40,
        scenario: "å¹´è¼•è‚¥èƒ–ï¼Œåå½ˆå¾Œæ˜é¡¯æ”¹å–„",
        target: 7.0,
        latestHba1c: 6.1,
        egfr: 95,
        bmi: 33,
        hba1cSeries: [9.2,9.0,8.7,8.5,8.2,8.0,7.8,7.9,7.7,7.5,7.3,7.1,6.9,6.8,6.7,6.6,6.5,6.4,6.3,6.2,6.2,6.1,6.1,6.1,6.1]
      },
      {
        id: "684487",
        name: "ææ€¡å›",
        gender: "å¥³",
        birthDate: "1973-08-10",
        age: 52,
        scenario: "æ§åˆ¶è‰¯å¥½ï¼Œå¯è€ƒæ…®æ¸›è—¥",
        target: 7.0,
        latestHba1c: 5.8,
        egfr: 100,
        bmi: 21,
        hba1cSeries: [6.8,6.7,6.6,6.5,6.4,6.3,6.2,6.1,6.0,6.0,5.9,5.9,5.9,5.8,5.8,5.8,5.8,5.8,5.8,5.8,5.8,5.8,5.8,5.8,5.8]
      }
    ];

    // ç”Ÿæˆç—…äººé¸æ“‡å¡ç‰‡
    const selector = document.getElementById("patientSelector");
    patients.forEach((p, index) => {
      const card = document.createElement("div");
      card.className = "patient-card";
      card.innerHTML = `
        <h3>${p.name}</h3>
        <p><strong>æ€§åˆ¥ï¼š</strong>${p.gender}ã€€<strong>å¹´é½¡ï¼š</strong>${p.age}æ­²</p>
        <p><strong>è‡¨åºŠæƒ…å¢ƒï¼š</strong>${p.scenario}</p>
        <p><strong>å€‹äººåŒ–ç›®æ¨™ï¼š</strong>HbA1c â‰¤ ${p.target}%</p>
      `;
      card.onclick = () => selectPatient(p, index);
      selector.appendChild(card);
    });

    let currentPatient = null;
    let chart = null;

    function selectPatient(patient, index) {
      // é«˜äº®é¸ä¸­
      document.querySelectorAll(".patient-card").forEach(c => c.classList.remove("selected"));
      document.querySelectorAll(".patient-card")[index].classList.add("selected");

      currentPatient = patient;

      document.getElementById("patientName").textContent = `${patient.name} çš„ç”¨è—¥æ±ºç­–å ±å‘Š`;
      document.getElementById("patientInfo").innerHTML = `
        å¹´é½¡ï¼š${patient.age}æ­²ã€€|ã€€æ€§åˆ¥ï¼š${patient.gender}ã€€|ã€€è‡¨åºŠæƒ…å¢ƒï¼š${patient.scenario}
      `;

      // ç¹ªè£½ HbA1c è¶¨å‹¢åœ–
      if (chart) chart.destroy();
      const ctx = document.getElementById("hba1cChart").getContext("2d");
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length: 25}, (_, i) => {
            const year = 2023 + Math.floor(i / 12);
            const month = (i % 12) + 1;
            return `${year}-${month.toString().padStart(2, '0')}`;
          }),
          datasets: [{
            label: 'HbA1c (%)',
            data: patient.hba1cSeries,
            borderColor: '#3498db',
            backgroundColor: 'rgba(52, 152, 219, 0.1)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          scales: { y: { suggestedMin: 5, suggestedMax: 10 } }
        }
      });

      // æŒ‡æ¨™è‰²å¡Š
      const indicators = document.getElementById("indicators");
      indicators.innerHTML = `
        <div class="indicator">
          <div class="bar ${patient.latestHba1c <= patient.target ? 'green' : patient.latestHba1c <= patient.target + 0.5 ? 'yellow' : 'red'}">
            HbA1c ${patient.latestHba1c}%
          </div>
          <p>ç›®æ¨™ â‰¤ ${patient.target}%</p>
        </div>
        <div class="indicator">
          <div class="bar ${patient.egfr >= 90 ? 'green' : patient.egfr >= 60 ? 'yellow' : 'red'}">
            eGFR ${patient.egfr}
          </div>
          <p>mL/min/1.73mÂ²</p>
        </div>
        <div class="indicator">
          <div class="bar ${patient.bmi < 24 ? 'green' : patient.bmi < 27 ? 'yellow' : 'red'}">
            BMI ${patient.bmi}
          </div>
          <p>kg/mÂ²</p>
        </div>
      `;

      // ç”¨è—¥å»ºè­°
      const recs = document.getElementById("recommendations");
      let items = [];
      items.push(`<div class="rec-item">æœ€æ–° HbA1cï¼š${patient.latestHba1c}%ï¼ˆå€‹äººåŒ–ç›®æ¨™ â‰¤${patient.target}%ï¼‰</div>`);

      if (patient.scenario.includes("è…ç—…è®Š") || patient.egfr < 60) {
        items.push(`<div class="rec-item rec-high">ğŸ›¡ï¸ åˆä½µè…ç—…è®Šï¼šå¼·çƒˆå»ºè­°ä½¿ç”¨ SGLT2iï¼ˆè…ä¿è­·æ•ˆç›Šï¼‰</div>`);
      }
      if (patient.scenario.includes("è‚¥èƒ–") || patient.bmi >= 30) {
        items.push(`<div class="rec-item rec-high">âš– è‚¥èƒ–ç‚ºä¸»è¦å•é¡Œï¼šå„ªå…ˆè€ƒæ…® GLP-1 RAï¼ˆæ¸›é‡æ•ˆæœä½³ï¼‰</div>`);
      }
      if (patient.scenario.includes("é«˜é½¡") || patient.age >= 65) {
        items.push(`<div class="rec-item rec-high">ğŸ‘µ é«˜é½¡æ‚£è€…ï¼šé¿å…æ˜“å¼•èµ·ä½è¡€ç³–è—¥ç‰©ï¼ˆå¦‚ Sulfonylureaã€Insulinï¼‰ï¼Œç›®æ¨™æ”¾å¯¬</div>`);
      }
      if (patient.scenario.includes("æ§åˆ¶è‰¯å¥½") && patient.latestHba1c <= 6.5) {
        items.push(`<div class="rec-item" style="border-left-color:#27ae60;background:#f0fff4;">âœ… æ§åˆ¶æ¥µä½³ï¼Œå¯è€ƒæ…®æ¸›è—¥æˆ–å»éšæ¢¯åŒ–ï¼ˆde-prescribingï¼‰</div>`);
      }
      if (patient.scenario.includes("å¿«é€Ÿæ”¹å–„") || patient.scenario.includes("æ˜é¡¯æ”¹å–„")) {
        items.push(`<div class="rec-item" style="border-left-color:#27ae60;background:#f0fff4;">ğŸ“ˆ æ²»ç™‚æ•ˆæœé¡¯è‘—ï¼ŒæŒçºŒç›®å‰æ–¹æ¡ˆä¸¦å®šæœŸè¿½è¹¤</div>`);
      }

      recs.innerHTML = items.join("");

      document.getElementById("patientContent").style.display = "block";
      window.scrollTo({ top: document.getElementById("patientContent").offsetTop - 20, behavior: 'smooth' });
    }

    // æ–°å¢ï¼šè¿”å›é¸æ“‡é é¢å‡½æ•¸
    function backToSelector() {
      document.getElementById("patientContent").style.display = "none";
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
</body>
</html>